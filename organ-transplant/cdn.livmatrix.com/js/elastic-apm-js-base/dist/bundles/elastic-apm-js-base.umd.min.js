/*! For license information please see elastic-apm-js-base.umd.min.js.LICENSE */
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=[].slice;function o(){return"withCredentials"in new window.XMLHttpRequest}function a(e,t,n,r){return"number"==typeof e&&(e=String(e)),n&&!e&&(e=r||"NA"),e?String(e).substr(0,t):e}var s=["fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];function c(e){return null!==e&&"object"===(void 0===e?"undefined":r(e))}function u(e){return"function"==typeof e}e.exports={getPageMetadata:function(){return{page:{referer:document.referrer,url:window.location.href}}},extend:function(e){return this.baseExtend(e,i.call(arguments,1),!1)},merge:function(e){return this.baseExtend(e,i.call(arguments,1),!0)},baseExtend:function e(t,n,r){for(var i=0,o=n.length;i<o;++i){var a=n[i];if(c(a)||u(a))for(var s=Object.keys(a),f=0,l=s.length;f<l;f++){var v=s[f],h=a[v];r&&c(h)?(c(t[v])||(t[v]=Array.isArray(h)?[]:{}),e(t[v],[h],!1)):t[v]=h}}return t},isObject:c,isFunction:u,arrayReduce:function(e,t,n){if(null==e)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var r=Object(e),i=r.length>>>0,o=0;if(!n){for(;o<i&&!(o in r);)o++;if(o>=i)throw new TypeError("Reduce of empty array with no initial value");n=r[o++]}for(;o<i;o++)o in r&&(n=t(n,r[o],o,r));return n},arraySome:function(e,t,n){if(null==e)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof t)throw new TypeError;var r=Object(e),i=r.length>>>0;n||(n=void 0);for(var o=0;o<i;o++)if(o in r&&t.call(n,r[o],o,r))return!0;return!1},arrayMap:function(e,t,n){var r,i,o;if(null==this)throw new TypeError(" this is null or not defined");var a=Object(e),s=a.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(r=n),i=new Array(s),o=0;o<s;){var c,u;o in a&&(c=a[o],u=t.call(r,c,o,a),i[o]=u),o++}return i},arrayIndexOf:function(e,t,n){var r;if(null==e)throw new TypeError('"arrayVal" is null or not defined');var i=Object(e),o=i.length>>>0;if(0===o)return-1;var a=+n||0;if(Math.abs(a)===1/0&&(a=0),a>=o)return-1;for(r=Math.max(a>=0?a:o-Math.abs(a),0);r<o;){if(r in i&&i[r]===t)return r;r++}return-1},functionBind:function(e,t){var n=Array.prototype.slice.call(arguments,2),r=function(){},i=function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))};return r.prototype=e.prototype,i.prototype=new r,i},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},isUndefined:function(e){return void 0===e},isCORSSupported:o,getElasticScript:function(){if("undefined"!=typeof document)for(var e=document.getElementsByTagName("script"),t=0,n=e.length;t<n;t++){var r=e[t];if(r.src.indexOf("elastic")>0)return r}},getCurrentScript:function(){if("undefined"!=typeof document){var e=document.currentScript;return e||this.getElasticScript()}},generateUuid:function(){function e(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return e()+e(!0)+e(!0)+e()},parseUrl:function(e){var t=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/.exec(e),n=t[1]||"",r=t[3]||"",i=t[5]?"#"+t[5]:"",o="";e.indexOf("://")>-1&&(o=e.split("://")[0]+":");for(var a={},s=r.split("&"),c=0,u=s.length;c<u;c++){var f=s[c];if(""!==f&&void 0!==f&&null!==f){var l=s[c].split("=");a[l.shift()]=l.join("=")}}return{protocol:o,path:n,queryString:r,queryStringParsed:a,hash:i}},isPlatformSupported:function(){return"undefined"!=typeof window&&"function"==typeof Array.prototype.forEach&&"function"==typeof JSON.stringify&&"function"==typeof Function.bind&&window.performance&&"function"==typeof window.performance.now&&o()},sanitizeString:a,sanitizeObjectStrings:function e(t,n,i,o){return t?"string"==typeof t?a(t,n,i,o):(Object.keys(t).forEach(function(s){var c=t[s];"string"==typeof c?c=a(t[s],n,i,o):"object"===(void 0===c?"undefined":r(c))&&(c=e(c,n,i,o)),t[s]=c}),t):t},getNavigationTimingMarks:function(){if(window.performance&&window.performance.timing){var e=window.performance.timing,t={},n=e.fetchStart;return s.forEach(function(r){var i=e[r];i&&i>=n&&(t[r]=i-n)}),t}}}},function(e,t,n){"use strict";var r=n(8),i=n(15),o=n(20),a=n(0),s=n(26);e.exports={createServiceFactory:function(){var e=new o;return e.registerCoreServices(),r.registerServices(e),i.registerServices(e),e},ServiceFactory:o,patching:s,utils:a}},function(e,t,n){"use strict";function r(){this.subscriptions=[]}r.prototype.subscribe=function(e){var t=this;return this.subscriptions.push(e),function(){var n=t.subscriptions.indexOf(e);n>-1&&t.subscriptions.splice(n,1)}},r.prototype.applyAll=function(e,t){this.subscriptions.forEach(function(n){try{n.apply(e,t)}catch(e){console.log(e,e.stack)}},this)},e.exports=r},function(e,t,n){"use strict";var r=n(10),i=n(11);e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(0),o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=r||{};"function"==typeof i.onSpanEnd?this.onSpanEnd=i.onSpanEnd:this.onSpanEnd=function(){},this.signature=t,this.type=n,this.ended=!1,this._end=void 0,this.context=void 0,this._start=window.performance.now()}return r(e,[{key:"end",value:function(){this.ended||(this._end=window.performance.now(),this.ended=!0,this.onSpanEnd(this))}},{key:"duration",value:function(){if(i.isUndefined(this._end)||i.isUndefined(this._start))return null;var e=this._end-this._start;return parseFloat(e)}},{key:"setContext",value:function(e){e&&(this.context=i.merge(this.context||{},e))}}]),e}();e.exports=o},function(e,t,n){"use strict";function r(e){return"__apm_symbol__"+e}e.exports={apmSymbol:r,patchMethod:function(e,t,n){var i=e;for(;i&&!i.hasOwnProperty(t);)i=Object.getPrototypeOf(i);!i&&e[t]&&(i=e);var o,a=r(t);if(i&&!(o=i[a])){o=i[a]=i[t];var s=i&&Object.getOwnPropertyDescriptor(i,t);if(function(e){if(!e)return!0;if(!1===e.writable)return!1;return!("function"==typeof e.get&&void 0===e.set)}(s)){var c=n(o,a,t);i[t]=function(){return c(this,arguments)},u=i[t],f=o,u[r("OriginalDelegate")]=f}}var u,f;return o}}},function(e,t,n){"use strict";var r=n(7)(),i=n(1),o=n(30),a=new o(i.createServiceFactory(),!r);"undefined"!=typeof window&&(window.elasticApm=a);var s={__esModule:!0,default:a.init.bind(a),init:a.init.bind(a),ApmBase:o,apmBase:a,apm:a};e.exports=s},function(e,t,n){"use strict";var r=!1,i=!1;e.exports=function(){if(r)return i;r=!0;var e=n(1);return e.utils.isPlatformSupported()?(n(28),e.patching.patchAll(),i=!0):console.log("APM: Platform is not supported!"),i}},function(e,t,n){"use strict";var r=n(9);e.exports={ErrorLogging:r,registerServices:function(e){e.registerServiceCreator("ErrorLogging",function(){var t=e.getService("ApmServer"),n=e.getService("ConfigService"),i=e.getService("LoggingService");return new r(t,n,i)})}}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(3),a=n(12),s=n(0),c=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._apmServer=t,this._configService=n,this._loggingService=r,this._stackTraceService=new a(n,r)}return i(e,[{key:"createErrorDataModel",value:function(e){var t,n=this._stackTraceService.cleanFilePath(e.filename),i=this._stackTraceService.filePathToFileName(n),a=this._stackTraceService.createStackTraces(e);if(a=this._stackTraceService.filterInvalidFrames(a),!i&&a.length){var c=a[a.length-1];i=c.filename?c.filename:"(inline script)"}t=this._stackTraceService.isFileInline(n)?"(inline script)":i;var u=e.message||e.error&&e.error.message,f=e.error?e.error.name:void 0;f||(f=u&&u.indexOf(":")>-1?u.split(":")[0]:"");var l,v=this._configService.get("context"),h=this._configService.get("serverStringLimit");e.error&&"object"===r(e.error)&&(l=this._getErrorProperties(e.error));var d=s.getPageMetadata(),p=s.merge({},d,v,l);return{id:o(),culprit:s.sanitizeString(t),exception:{message:s.sanitizeString(u,void 0,!0),stacktrace:a,type:s.sanitizeString(f,h,!1)},context:p}}},{key:"logErrorEvent",value:function(e,t){if(this._configService.isActive()){if(void 0===e)return;var n=this.createErrorDataModel(e);if(void 0===n.exception.message)return;return t?this._apmServer.sendErrors([n]):this._apmServer.addError(n)}}},{key:"registerGlobalEventListener",value:function(){var e=this;window.onerror=function(t,n,r,i,o){var a;a=void 0!==t&&"string"!=typeof t?t:{message:t,filename:n,lineno:r,colno:i,error:o},e.logErrorEvent(a)}}},{key:"logError",value:function(e){var t={};return"string"==typeof e?t.message=e:t.error=e,this.logErrorEvent(t)}},{key:"_getErrorProperties",value:function(e){var t={};return Object.keys(e).forEach(function(n){if("stack"!==n){var i=e[n];if(null!==i){switch(void 0===i?"undefined":r(i)){case"function":return;case"object":if("function"!=typeof i.toISOString)return;i=i.toISOString()}t[n]=i}}}),t}}]),e}();e.exports=c},function(e,t,n){"use strict";var r="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(r){var i=new Uint8Array(16);e.exports=function(){return r(i),i}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t,n){"use strict";for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,i=r;return i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(13),o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._configService=t,this._loggingService=n}return r(e,[{key:"createStackTraces",value:function(e){var t,n=this,r=e.error;if(r)try{t=i.parse(r)}catch(e){this._loggingService.debug("Parsing error stack failed!",e)}return t&&0!==t.length||(t=[{fileName:e.filename,lineNumber:e.lineno,columnNumber:e.colno}]),t=(t=t.map(function(e){return e.functionName&&(e.functionName=(t=e.functionName,n=t.split("/"),t=(t=(t=n.length>1?["Object",n[n.length-1]].join("."):n[0]).replace(/.<$/gi,".<anonymous>")).replace(/^Anonymous function$/,"<anonymous>"),t=(n=t.split(".")).length>1?n[n.length-1]:n[0])),e;var t,n})).map(function(e){if(!e.fileName&&!e.lineNumber)return{};if(!e.columnNumber&&!e.lineNumber)return{};var t=n.cleanFilePath(e.fileName),r=n.filePathToFileName(t);return n.isFileInline(t)&&(r="(inline script)"),{abs_path:e.fileName,filename:r,function:e.functionName||"<anonymous>",lineno:e.lineNumber,colno:e.columnNumber}})}},{key:"filterInvalidFrames",value:function(e){var t=[];return Array.isArray(e)&&(t=e.filter(function(e){return void 0!==e.filename&&void 0!==e.lineno})),t}},{key:"filePathToFileName",value:function(e){var t=window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");return e.indexOf(t)>-1&&(e=e.replace(t+"/","")),e}},{key:"cleanFilePath",value:function(e){return e||(e=""),"<anonymous>"===e&&(e=""),e}},{key:"isFileInline",value:function(e){return!!e&&0===window.location.href.indexOf(e)}}]),e}();e.exports=o},function(e,t,n){"use strict";var r,i,o,a;"function"==typeof Symbol&&Symbol.iterator;a=function(e){var t=/(^|@)\S+\:\d+/,n=/^\s*at .*(\S+\:\d+|\(native\))/m,r=/^(eval@)?(\[native code\])?$/;function i(e,t,n){if("function"==typeof Array.prototype.map)return e.map(t,n);for(var r=new Array(e.length),i=0;i<e.length;i++)r[i]=t.call(n,e[i]);return r}function o(e,t,n){if("function"==typeof Array.prototype.filter)return e.filter(t,n);for(var r=[],i=0;i<e.length;i++)t.call(n,e[i])&&r.push(e[i]);return r}return{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(n))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(e.replace(/[\(\)]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(t){return i(o(t.stack.split("\n"),function(e){return!!e.match(n)},this),function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var n=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),r=this.extractLocation(n.pop()),i=n.join(" ")||void 0,o=function(e,t){if("function"==typeof Array.prototype.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}(["eval","<anonymous>"],r[0])>-1?void 0:r[0];return new e(i,void 0,o,r[1],r[2],t)},this)},parseFFOrSafari:function(t){return i(o(t.stack.split("\n"),function(e){return!e.match(r)},this),function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e(t);var n=t.split("@"),r=this.extractLocation(n.pop()),i=n.join("@")||void 0;return new e(i,void 0,r[0],r[1],r[2],t)},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,r=t.message.split("\n"),i=[],o=2,a=r.length;o<a;o+=2){var s=n.exec(r[o]);s&&i.push(new e(void 0,void 0,s[2],s[1],void 0,r[o]))}return i},parseOpera10:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=t.stacktrace.split("\n"),i=[],o=0,a=r.length;o<a;o+=2){var s=n.exec(r[o]);s&&i.push(new e(s[3]||void 0,void 0,s[2],s[1],void 0,r[o]))}return i},parseOpera11:function(n){return i(o(n.stack.split("\n"),function(e){return!!e.match(t)&&!e.match(/^Error created at/)},this),function(t){var n,r=t.split("@"),i=this.extractLocation(r.pop()),o=r.shift()||"",a=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;o.match(/\(([^\)]*)\)/)&&(n=o.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var s=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new e(a,s,i[0],i[1],i[2],t)},this)}}},i=[n(14)],void 0===(o="function"==typeof(r=a)?r.apply(t,i):r)||(e.exports=o)},function(e,t,n){"use strict";var r,i,o;"function"==typeof Symbol&&Symbol.iterator;i=[],void 0===(o="function"==typeof(r=function(){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}function t(e,t,n,r,i,o){void 0!==e&&this.setFunctionName(e),void 0!==t&&this.setArgs(t),void 0!==n&&this.setFileName(n),void 0!==r&&this.setLineNumber(r),void 0!==i&&this.setColumnNumber(i),void 0!==o&&this.setSource(o)}return t.prototype={getFunctionName:function(){return this.functionName},setFunctionName:function(e){this.functionName=String(e)},getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getFileName:function(){return this.fileName},setFileName:function(e){this.fileName=String(e)},getLineNumber:function(){return this.lineNumber},setLineNumber:function(t){if(!e(t))throw new TypeError("Line Number must be a Number");this.lineNumber=Number(t)},getColumnNumber:function(){return this.columnNumber},setColumnNumber:function(t){if(!e(t))throw new TypeError("Column Number must be a Number");this.columnNumber=Number(t)},getSource:function(){return this.source},setSource:function(e){this.source=String(e)},toString:function(){return(this.getFunctionName()||"{anonymous}")+("("+(this.getArgs()||[]).join(",")+")")+(this.getFileName()?"@"+this.getFileName():"")+(e(this.getLineNumber())?":"+this.getLineNumber():"")+(e(this.getColumnNumber())?":"+this.getColumnNumber():"")}},t})?r.apply(t,i):r)||(e.exports=o)},function(e,t,n){"use strict";var r=n(16),i=n(17);e.exports={PerformanceMonitoring:r,registerServices:function(e){e.registerServiceCreator("TransactionService",function(){var t=e.getService("ConfigService"),n=e.getService("LoggingService");return new i(n,t)}),e.registerServiceCreator("PerformanceMonitoring",function(){var t=e.getService("ConfigService"),n=e.getService("LoggingService"),i=e.getService("ApmServer"),o=e.getService("TransactionService");return new r(i,t,n,void 0,o)})}}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(0),o=function(){function e(t,n,r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._apmServer=t,this._configService=n,this._logginService=r,this._zoneService=i,this._transactionService=o}return r(e,[{key:"init",value:function(){this._zoneService&&this._zoneService.initialize(window.Zone.current);var e=this;this._transactionService.subscribe(function(t){var n=e.createTransactionPayload(t);n&&e._apmServer.addTransaction(n)})}},{key:"setTransactionContextInfo",value:function(e){var t=this._configService.get("context");t&&e.addContextInfo(t)}},{key:"filterTransaction",value:function(e){var t=this._configService.get("transactionDurationThreshold"),n=e.duration();if(!n||n>t||!e.spans.length)return!1;var r=this._configService.get("browserResponsivenessInterval");if(this._configService.get("checkBrowserResponsiveness")&&!e.isHardNavigation){var i=this._configService.get("browserResponsivenessBuffer");if(!this.checkBrowserResponsiveness(e,r,i))return this._logginService.debug("Transaction was discarded! browser was not responsive enough during the transaction."," duration:",n," browserResponsivenessCounter:",e.browserResponsivenessCounter,"interval:",r),!1}return!0}},{key:"prepareTransaction",value:function(e){if(e.spans.sort(function(e,t){return e._start-t._start}),this._configService.get("groupSimilarSpans")){var t=this._configService.get("similarSpanThreshold");e.spans=this.groupSmallContinuouslySimilarSpans(e,t)}this.setTransactionContextInfo(e)}},{key:"createTransactionDataModel",value:function(e){var t=this._configService.get("context"),n=this._configService.get("serverStringLimit"),r=e._rootSpan._start,o=e.spans.map(function(e){var t;return e.context&&(t=i.sanitizeObjectStrings(e.context,n)),{name:i.sanitizeString(e.signature,n,!0),type:i.sanitizeString(e.type,n,!0),start:e._start-r,duration:e.duration(),context:t}}),a=i.merge({},t,e.contextInfo);return{id:e.id,timestamp:e.timestamp,name:i.sanitizeString(e.name,n,!1),type:i.sanitizeString(e.type,n,!0),duration:e.duration(),spans:o,context:a,marks:e.marks}}},{key:"createTransactionPayload",value:function(e){if(this.prepareTransaction(e),this.filterTransaction(e))return this.createTransactionDataModel(e)}},{key:"sendTransactions",value:function(e){var t=e.map(this.createTransactionPayload.bind(this)).filter(function(e){return e});return this._logginService.debug("Sending Transactions to apm server.",e.length),this._apmServer.sendTransactions(t)}},{key:"convertTransactionsToServerModel",value:function(e){return e.map(this.createTransactionDataModel.bind(this))}},{key:"groupSmallContinuouslySimilarSpans",value:function(e,t){var n=e.duration(),r=[],i=1;return e.spans.forEach(function(o,a){if(0===r.length)r.push(o);else{var s=r[r.length-1],c=s.type===o.type&&s.signature===o.signature&&o.duration()/n<t&&(o._start-s._end)/n<t,u=e.spans.length===a+1;c&&(i++,s._end=o._end),i>1&&(!c||u)&&(s.signature=i+"x "+s.signature,i=1),c||r.push(o)}}),r}},{key:"checkBrowserResponsiveness",value:function(e,t,n){var r=e.browserResponsivenessCounter;if(void 0===t||void 0===r)return!0;var i=e.duration();return r+n>=Math.floor(i/t)}}]),e}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(18),o=n(0),a=n(2),s=n(19).captureHardNavigation,c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=n,void 0===n&&t.debug("TransactionService: config is not provided"),this._logger=t,this.marks={},this.initialPageLoadName=void 0,this.currentTransaction=void 0,this._subscription=new a,this._alreadyCapturedPageLoad=!1}return r(e,[{key:"shouldCreateTransaction",value:function(){return this._config.isActive()}},{key:"getOrCreateCurrentTransaction",value:function(){if(this.shouldCreateTransaction()){var e=this.getCurrentTransaction();return o.isUndefined(e)||e.ended?this.createZoneTransaction():e}}},{key:"getCurrentTransaction",value:function(){return this.currentTransaction}},{key:"setCurrentTransaction",value:function(e){this.currentTransaction=e}},{key:"createTransaction",value:function(e,t,n){var r=n;if(o.isUndefined(r)&&(r=this._config.config),this.shouldCreateTransaction()){var a=new i(e,t,r,this._logger);return this.setCurrentTransaction(a),r.checkBrowserResponsiveness&&this.startCounter(a),a}}},{key:"createZoneTransaction",value:function(){return this.createTransaction("ZoneTransaction","transaction")}},{key:"startCounter",value:function(e){e.browserResponsivenessCounter=0;var t=this._config.get("browserResponsivenessInterval");void 0!==t?this.runOuter(function(){var n=setInterval(function(){e.ended?window.clearInterval(n):e.browserResponsivenessCounter++},t)}):this._logger.debug("browserResponsivenessInterval is undefined!")}},{key:"sendPageLoadMetrics",value:function(e){var t,n=this,r=this._config.config;t=this.getCurrentTransaction();var o=e||this.initialPageLoadName,a=!1;return o||(o="Unknown",a=!0),t&&"ZoneTransaction"===t.name?t.redefine(o,"page-load",r):t=new i(o,"page-load",r,this._logger),t.isHardNavigation=!0,t.unknownName=a,t.doneCallback=function(){n.applyAsync(function(){n.capturePageLoadMetrics(t)&&n.add(t)})},t.detectFinish(),t}},{key:"capturePageLoadMetrics",value:function(e){if(this._config.get("capturePageLoad")&&!this._alreadyCapturedPageLoad&&e.isHardNavigation)return e.addMarks(this.marks),s(e),this._alreadyCapturedPageLoad=!0,!0}},{key:"startTransaction",value:function(e,t){var n=this,r=this._config.config;if(t||(t="custom"),"interaction"!==t||r.captureInteractions){var i=this.getOrCreateCurrentTransaction();if(i)return"ZoneTransaction"!==i.name?(this.logInTransaction("Ending early to start a new transaction:",e,t),this._logger.debug("Ending old transaction",i),i.end(),i=this.createTransaction(e,t)):i.redefine(e,t,r),this._logger.debug("TransactionService.startTransaction",i),i.doneCallback=function(){n.applyAsync(function(){n._logger.debug("TransactionService transaction finished",i),i.spans.length>0&&!n.shouldIgnoreTransaction(i.name)&&(n.capturePageLoadMetrics(i),n.add(i))})},i}}},{key:"applyAsync",value:function(e,t,n){return this.runOuter(function(){return Promise.resolve().then(function(){return e.apply(t,n)},function(e){console.log(e)})})}},{key:"shouldIgnoreTransaction",value:function(e){for(var t=this._config.get("ignoreTransactions"),n=0;n<t.length;n++){var r=t[n];if("function"==typeof r.test){if(r.test(e))return!0}else if(r===e)return!0}return!1}},{key:"startSpan",value:function(e,t){var n=this.getOrCreateCurrentTransaction();if(n)return this._logger.debug("TransactionService.startSpan",e,t),n.startSpan(e,t)}},{key:"add",value:function(e){this._config.isActive()&&(this._subscription.applyAll(this,[e]),this._logger.debug("TransactionService.add",e))}},{key:"subscribe",value:function(e){return this._subscription.subscribe(e)}},{key:"addTask",value:function(e){var t=this.getOrCreateCurrentTransaction();return t&&(t.addTask(e),this._logger.debug("TransactionService.addTask",e)),e}},{key:"removeTask",value:function(e){var t=this.getCurrentTransaction();o.isUndefined(t)||t.ended||(t.removeTask(e),this._logger.debug("TransactionService.removeTask",e))}},{key:"logInTransaction",value:function(){var e=this.getCurrentTransaction();o.isUndefined(e)||e.ended||e.debugLog.apply(e,arguments)}},{key:"setDebugDataOnTransaction",value:function(e,t){var n=this.getCurrentTransaction();o.isUndefined(n)||n.ended||n.setDebugData(e,t)}},{key:"detectFinish",value:function(){var e=this.getCurrentTransaction();o.isUndefined(e)||e.ended||(e.detectFinish(),this._logger.debug("TransactionService.detectFinish"))}},{key:"runOuter",value:function(e,t,n){return e.apply(t,n)}}]),e}();e.exports=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(4),o=n(0),a=n(3),s=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=a(),this.timestamp=void 0,this.name=t,this.type=n,this.ended=!1,this._isDone=!1,this._options=r,this._logger=o,void 0===r&&(this._options={}),this.contextInfo={},this.marks,this._options.sendVerboseDebugInfo&&this.debugLog("Transaction",t,n),this.spans=[],this._activeSpans={},this._scheduledTasks={},this.doneCallback=function(){},this._rootSpan=new i("transaction","transaction"),this.duration=this._rootSpan.duration.bind(this._rootSpan),this.nextSpanId=0,this.nextAutoTaskId=0,this.isHardNavigation=!1}return r(e,[{key:"debugLog",value:function(){if(this._options.sendVerboseDebugInfo){this.contextInfo._debug||(this.contextInfo._debug={log:[]}),this.contextInfo._debug.log||(this.contextInfo._debug.log=[]);var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.unshift(Date.now().toString());var t=e.join(" - ");this.contextInfo._debug.log.push(t),this._logger&&this._logger.debug(t)}}},{key:"addContextInfo",value:function(e){o.merge(this.contextInfo,e)}},{key:"setDebugData",value:function(e,t){this.contextInfo._debug||(this.contextInfo._debug={}),this.contextInfo._debug[e]=t}},{key:"addNavigationTimingMarks",value:function(){var e=o.getNavigationTimingMarks();if(e){var t={timeToFirstByte:e.responseStart,domInteractive:e.domInteractive,domComplete:e.domComplete};this.addMarks({navigationTiming:e,agent:t})}}},{key:"addMarks",value:function(e){this.marks=o.merge(this.marks||{},e)}},{key:"mark",value:function(e){var t=e.replace(/[.*]/g,"_"),n=window.performance.now()-this._rootSpan._start,r={};r[t]=n,this.addMarks({custom:r})}},{key:"redefine",value:function(e,t,n){this.debugLog("redefine",e,t),this.name=e,this.type=t,this._options=n}},{key:"startSpan",value:function(e,t,n){var r=this;this.debugLog("startSpan",e,t);var o=void 0===n?{}:n;o.onSpanEnd=function(e){r._onSpanEnd(e)};var a=new i(e,t,o);return a.id=this.nextSpanId,this.nextSpanId++,this._activeSpans[a.id]=a,a}},{key:"isFinished",value:function(){return 0===Object.keys(this._scheduledTasks).length}},{key:"detectFinish",value:function(){this.isFinished()&&this.end()}},{key:"end",value:function(){if(!this.ended){this.debugLog("end"),this.ended=!0;var e=o.getPageMetadata();this.addContextInfo(e),this._rootSpan.end(),this._adjustStartToEarliestSpan(),this._adjustEndToLatestSpan(),this.doneCallback(this)}}},{key:"addTask",value:function(e){return void 0===e&&(e="autoId"+this.nextAutoTaskId++),this.debugLog("addTask",e),this._scheduledTasks[e]=e,e}},{key:"removeTask",value:function(e){this.debugLog("removeTask",e),this.setDebugData("lastRemovedTask",e),delete this._scheduledTasks[e],this.detectFinish()}},{key:"addEndedSpans",value:function(e){this.spans=this.spans.concat(e)}},{key:"_onSpanEnd",value:function(e){this.spans.push(e),e._scheduledTasks=Object.keys(this._scheduledTasks),delete this._activeSpans[e.id]}},{key:"_adjustEndToLatestSpan",value:function(){var e=function(e){for(var t=null,n=0;n<e.length;n++){var r=e[n];r.type&&-1===r.type.indexOf("ext")&&"transaction"!==r.type&&(!t||t._end<r._end)&&(t=r)}return t}(this.spans);if(e){this._rootSpan._end=e._end;for(var t=0;t<this.spans.length;t++){var n=this.spans[t];n._end>this._rootSpan._end&&(n._end=this._rootSpan._end,n.type=n.type+".truncated")}}}},{key:"_adjustStartToEarliestSpan",value:function(){var e,t,n=(e=this.spans,t=null,e.forEach(function(e){t||(t=e),t&&t._start>e._start&&(t=e)}),t);n&&n._start<this._rootSpan._start&&(this._rootSpan._start=n._start)}}]),e}();e.exports=s},function(e,t,n){"use strict";var r=n(4),i=n(0),o=[["domainLookupStart","domainLookupEnd","Domain lookup"],["connectStart","connectEnd","Making a connection to the server"],["requestStart","responseStart","Requesting the document, waiting for the first byte"],["responseStart","responseEnd","Receiving the document"],["domLoading","domInteractive","Parsing the document, executing sync. scripts"],["domContentLoadedEventStart","domContentLoadedEventEnd",'Fire "DOMContentLoaded" event'],["loadEventStart","loadEventEnd",'Fire "load" event']],a=3e5;function s(e,t){var n=t.duration();return n<a&&n>0&&t._start<=e._rootSpan._end&&t._end<=e._rootSpan._end}function c(e,t){for(var n=[],i=0;i<o.length;i++){var s=e[o[i][0]],c=e[o[i][1]];if(t&&s&&c&&c>s&&s>=t&&c-s<a&&s-t<a&&c-t<a){var u=new r(o[i][2],"hard-navigation.browser-timing");u._start=s-t,u.ended=!0,u._end=c-t,n.push(u)}}return n}function u(e,t){for(var n=[],o=0;o<e.length;o++){var s=e[o];if((!s.initiatorType||"xmlhttprequest"!==s.initiatorType)&&s.name)if("css"!==s.initiatorType&&"img"!==s.initiatorType&&"script"!==s.initiatorType&&"link"!==s.initiatorType){for(var c=!1,u=0;u<t.length;u++){var f=s.name.lastIndexOf(t[u]);if(f>-1&&f===s.name.length-t[u].length){c=!0;break}}if(c)continue}else{var l="resource";s.initiatorType&&(l+="."+s.initiatorType);var v=s.startTime,h=s.responseEnd;if("number"==typeof v&&"number"==typeof h&&v>=0&&h>v&&h-v<a&&v<a&&h<a){var d=i.parseUrl(s.name),p=new r(d.path||s.name,l);p.setContext({http:{url:s.name}}),p._start=v,p.ended=!0,p._end=h,n.push(p)}}}return n}e.exports={captureHardNavigation:function(e){if(e.isHardNavigation&&window.performance&&window.performance.timing){var t=window.performance.timing.fetchStart,n=window.performance.timing;e._rootSpan._start=0,e.type="page-load",c(n,t).forEach(function(t){s(e,t)&&e.spans.push(t)}),window.performance.getEntriesByType&&u(window.performance.getEntriesByType("resource"),e.spans.filter(function(e){return e.type.indexOf("ext.HttpRequest")>-1}).map(function(e){return e.signature.split(" ")[1]})).forEach(function(t){s(e,t)&&e.spans.push(t)}),e._adjustStartToEarliestSpan(),e._adjustEndToLatestSpan(),e.addNavigationTimingMarks()}},createNavigationTimingSpans:c,createResourceTimingSpans:u}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(21),o=n(24),a=n(25),s=n(5),c=n(0),u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._serviceCreators={},this._serviceInstances={},this.initialized=!1}return r(e,[{key:"registerCoreServices",value:function(){var e=this;this.registerServiceCreator("ConfigService",function(){return new o}),this.registerServiceCreator("LoggingService",function(){return new a}),this.registerServiceCreator("ApmServer",function(){return new i(e.getService("ConfigService"),e.getService("LoggingService"))}),this.registerServiceInstance("PatchUtils",s),this.registerServiceInstance("Utils",c)}},{key:"init",value:function(){if(!this.initialized){this.initialized=!0;var e=this.getService("ConfigService");e.init();var t=this.getService("LoggingService");n(t,e),e.subscribeToChange(function(r){n(t,e)}),this.getService("ApmServer").init()}function n(e,t){!0===t.get("debug")&&"trace"!==t.config.logLevel?e.setLevel("debug",!1):e.setLevel(t.get("logLevel"),!1)}}},{key:"registerServiceCreator",value:function(e,t){this._serviceCreators[e]=t}},{key:"registerServiceInstance",value:function(e,t){this._serviceInstances[e]=t}},{key:"getService",value:function(e){if(!this._serviceInstances[e]){if("function"!=typeof this._serviceCreators[e])throw new Error("Can not get service, No creator for: "+e);this._serviceInstances[e]=this._serviceCreators[e](this)}return this._serviceInstances[e]}}]),e}();e.exports=u},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(22),o=n(23),a=n(0),s=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._configService=t,this._loggingService=n,this.logMessages={invalidConfig:{message:"Configuration is invalid!",level:"warn"}},this.errorQueue=void 0,this.transactionQueue=void 0,this.throttleAddError=void 0,this.throttleAddTransaction=void 0,this.initialized=!1}return r(e,[{key:"init",value:function(){this.initialized||(this.initialized=!0,this.initErrorQueue(),this.initTransactionQueue())}},{key:"createServiceObject",value:function(){var e=this._configService,t=e.get("serverStringLimit");return{name:a.sanitizeString(e.get("serviceName"),t,!0),version:a.sanitizeString(e.get("serviceVersion"),t,!1),agent:{name:e.get("agentName"),version:e.get("agentVersion")},language:{name:"javascript"}}}},{key:"_postJson",value:function(e,t){return this._makeHttpRequest("POST",e,JSON.stringify(t),{"Content-Type":"application/json"})}},{key:"_makeHttpRequest",value:function(e,t,n,r){return new Promise(function(i,o){var a=new window.XMLHttpRequest;if(a.open(e,t,!0),a.timeout=1e4,r)for(var s in r)r.hasOwnProperty(s)&&a.setRequestHeader(s,r[s]);a.onreadystatechange=function(e){if(4===a.readyState){var n=a.status;if(0===n||n>399&&n<600){var r=new Error(t+" HTTP status: "+n);r.xhr=a,o(r)}else i(a.responseText)}},a.onerror=function(e){o(e)},a.send(n)})}},{key:"_createQueue",value:function(e){var t=this._configService.get("queueLimit"),n=this._configService.get("flushInterval");return new i(e,{queueLimit:t,flushInterval:n})}},{key:"initErrorQueue",value:function(){var e=this;this.errorQueue&&this.errorQueue.flush(),this.errorQueue=this._createQueue(function(t){var n=e.sendErrors(t);n&&n.then(void 0,function(t){e._loggingService.warn("Failed sending errors!",t)})});var t=e._configService.get("errorThrottleLimit"),n=e._configService.get("errorThrottleInterval");this.throttleAddError=o(this.errorQueue.add.bind(this.errorQueue),function(t,n){e._loggingService.warn("Dropped error due to throttling!")},{limit:t,interval:n})}},{key:"initTransactionQueue",value:function(){var e=this;this.transactionQueue&&this.transactionQueue.flush(),this.transactionQueue=this._createQueue(function(t){var n=e.sendTransactions(t);n&&n.then(void 0,function(t){e._loggingService.warn("Failed sending transactions!",t)})});var t=e._configService.get("transactionThrottleLimit"),n=e._configService.get("transactionThrottleInterval");this.throttleAddTransaction=o(this.transactionQueue.add.bind(this.transactionQueue),function(){e._loggingService.warn("Dropped transaction due to throttling!")},{limit:t,interval:n})}},{key:"addError",value:function(e){this._configService.isActive()&&(this.errorQueue||this.initErrorQueue(),this.throttleAddError(e))}},{key:"addTransaction",value:function(e){this._configService.isActive()&&(this.transactionQueue||this.initTransactionQueue(),this.throttleAddTransaction(e))}},{key:"warnOnce",value:function(e){"warn"===e.level?(e.level="debug",this._loggingService.warn(e.message)):this._loggingService.debug(e.message)}},{key:"sendErrors",value:function(e){if(this._configService.isValid()&&this._configService.isActive()){if(e&&e.length>0){var t={service:this.createServiceObject(),errors:e};if(t=this._configService.applyFilters(t)){var n=this._configService.getEndpointUrl("errors");return this._postJson(n,t)}this._loggingService.warn("Dropped payload due to filtering!")}}else this.warnOnce(this.logMessages.invalidConfig)}},{key:"sendTransactions",value:function(e){if(this._configService.isValid()&&this._configService.isActive()){if(e&&e.length>0){var t={service:this.createServiceObject(),transactions:e};if(t=this._configService.applyFilters(t)){var n=this._configService.getEndpointUrl("transactions");return this._postJson(n,t)}this._loggingService.warn("Dropped payload due to filtering!")}}else this.warnOnce(this.logMessages.invalidConfig)}}]),e}();e.exports=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n||(n={}),this.onFlush=t,this.items=[],this.queueLimit=n.queueLimit||-1,this.flushInterval=n.flushInterval||0,this.timeoutId=void 0}return r(e,[{key:"_setTimer",value:function(){var e=this;this.timeoutId=setTimeout(function(){e.flush()},this.flushInterval)}},{key:"flush",value:function(){this.onFlush(this.items),this._clear()}},{key:"_clear",value:function(){void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.items=[]}},{key:"add",value:function(e){this.items.push(e),-1!==this.queueLimit&&this.items.length>=this.queueLimit?this.flush():void 0===this.timeoutId&&this._setTimer()}}]),e}();e.exports=i},function(e,t,n){"use strict";e.exports=function(e,t,n){var r,i=n.context||this,o=n.limit,a=n.interval,s=n.countFn||function(){},c=0;return function(){var n="function"==typeof s&&s.apply(i,arguments);return"number"!=typeof n&&(n=1),c+=n,void 0===r&&(r=setTimeout(function(){c=0,r=void 0},a)),c>o?"function"==typeof t?t.apply(i,arguments):void 0:e.apply(i,arguments)}}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(0),o=n(2);function a(){this.config={},this.defaults={serviceName:"",serviceVersion:"",agentName:"js-base",agentVersion:"0.10.3",serverUrl:"http://localhost:8200",serverUrlPrefix:"/v1/client-side",active:!0,isInstalled:!1,debug:!1,logLevel:"warn",browserResponsivenessInterval:500,browserResponsivenessBuffer:3,checkBrowserResponsiveness:!0,enable:!0,groupSimilarSpans:!0,similarSpanThreshold:.05,captureInteractions:!1,sendVerboseDebugInfo:!1,includeXHRQueryString:!1,capturePageLoad:!0,ignoreTransactions:[],errorThrottleLimit:20,errorThrottleInterval:3e4,transactionThrottleLimit:20,transactionThrottleInterval:3e4,transactionDurationThreshold:6e4,queueLimit:-1,flushInterval:500,sendPageLoadTransaction:!0,serverStringLimit:1024,context:{},platform:{}},this._changeSubscription=new o,this.filters=[]}a.prototype.isActive=function(){return this.get("active")},a.prototype.addFilter=function(e){if("function"!=typeof e)throw new Error("Argument to must be function");this.filters.push(e)},a.prototype.applyFilters=function(e){for(var t=0;t<this.filters.length;t++)if(!(e=this.filters[t](e)))return;return e},a.prototype.init=function(){var e=s();this.setConfig(e)},a.prototype.get=function(e){return i.arrayReduce(e.split("."),function(e,t){return e&&e[t]},this.config)},a.prototype.getEndpointUrl=function(e){return this.get("serverUrl")+this.get("serverUrlPrefix")+"/"+e},a.prototype.set=function(e,t){var n=e.split("."),r=n.length-1,o=this.config;i.arraySome(n,function(e,n){if(void 0===e)return!0;if(n===r)o[e]=t;else{var i=o[e]||{};o[e]=i,o=i}})},a.prototype.setUserContext=function(e){var t={};"number"==typeof e.id&&(t.id=e.id),"string"==typeof e.id&&(t.id=i.sanitizeString(e.id,this.get("serverStringLimit"))),"string"==typeof e.username&&(t.username=i.sanitizeString(e.username,this.get("serverStringLimit"))),"string"==typeof e.email&&(t.email=i.sanitizeString(e.email,this.get("serverStringLimit"))),this.set("context.user",t)},a.prototype.setCustomContext=function(e){e&&"object"===(void 0===e?"undefined":r(e))&&this.set("context.custom",e)},a.prototype.setTag=function(e,t){if(!e)return!1;this.config.context.tags||(this.config.context.tags={});var n=e.replace(/[.*]/g,"_");this.config.context.tags[n]=i.sanitizeString(t,this.get("serverStringLimit"))},a.prototype.setTags=function(e){var t=this;Object.keys(e).forEach(function(n){t.setTag(n,e[n])})},a.prototype.getAgentName=function(){var e=this.config.agentVersion;return e||(e="dev"),this.get("agentName")+"/"+e},a.prototype.setConfig=function(e){e=e||{},this.config=i.merge({},this.defaults,this.config,e),this._changeSubscription.applyAll(this,[this.config])},a.prototype.subscribeToChange=function(e){return this._changeSubscription.subscribe(e)},a.prototype.isValid=function(){var e=i.arrayMap(["serviceName","serverUrl"],i.functionBind(function(e){return null===this.config[e]||void 0===this.config[e]||""===this.config[e]},this));return-1===i.arrayIndexOf(e,!0)};var s=function(){return function(e){var t={},n=/^data\-([\w\-]+)$/;if(e)for(var r=e.attributes,o=0;o<r.length;o++){var a=r[o];if(n.test(a.nodeName)){var s=a.nodeName.match(n)[1];s=i.arrayMap(s.split("-"),function(e,t){return t>0?e.charAt(0).toUpperCase()+e.substring(1):e}).join(""),t[s]=a.value||a.nodeValue}}return t}(i.getCurrentScript())};a.prototype.isPlatformSupported=function(){return"function"==typeof Array.prototype.forEach&&"function"==typeof JSON.stringify&&"function"==typeof Function.bind&&window.performance&&"function"==typeof window.performance.now&&i.isCORSSupported()},e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(){}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t||(t={}),this.levels=["trace","debug","info","warn","error"],this.level=t.level||"info",this.prefix=t.prefix||"",this.resetLogMethods()}return r(e,[{key:"shouldLog",value:function(e){return this.levels.indexOf(e)>=this.levels.indexOf(this.level)}},{key:"setLevel",value:function(e){this.level=e,this.resetLogMethods()}},{key:"resetLogMethods",value:function(){var e=this;this.levels.forEach(function(t){e[t]=e.shouldLog(t)?function(){var n,r=e.prefix;switch(t){case"trace":case"debug":n="info";break;default:n=t}var i=arguments;r&&("function"==typeof r&&(r=r(t)),i[0]=r+i[0]);if(console){var o=console[n]?console[n]:console.log;"function"==typeof o&&o.apply(console,i)}}:i})}}]),e}();e.exports=o},function(e,t,n){"use strict";var r=n(27).patchXMLHttpRequest,i=new(n(2)),o=!1;e.exports={patchAll:function(){return o||(o=!0,r(function(e,t){i.applyAll(this,[e,t])})),i},subscription:i}},function(e,t,n){"use strict";var r=n(5),i=r.apmSymbol,o=r.patchMethod,a=i("xhrTask"),s=i("xhrListener"),c=i("xhrScheduled"),u=i("xhrSync"),f=i("xhrURL"),l=i("xhrMethod"),v="addEventListener",h="removeEventListener",d=!1;e.exports={patchXMLHttpRequest:function(e){if(!d){d=!0;var t=XMLHttpRequest.prototype,n=t[v],r=t[h];if(!n){var i=window.XMLHttpRequestEventTarget;if(i){var p=i.prototype;n=p[v],r=p[h]}}var g="readystatechange",y="schedule",m="invoke",S="clear",b=o(t,"open",function(){return function(e,t){return e[l]=t[0],e[u]=0==t[2],e[f]=t[1],b.apply(e,t)}}),_=o(t,"send",function(){return function(t,i){var o={source:"XMLHttpRequest.send",state:"",type:"macroTask",data:{target:t,method:t[l],sync:t[u],url:t[f],args:i,aborted:!1}},d=function(t){XMLHttpRequest[c]=!1,t.state=y,e(y,t);var i=t.data,o=i.target,u=o[s];n||(n=o[v],r=o[h]),u&&r.call(o,g,u);var f=o[s]=function(){o.readyState===o.DONE&&!i.aborted&&XMLHttpRequest[c]&&t.state===y&&T(t)};n.call(o,g,f),o[a]||(o[a]=t);var l=_.apply(o,i.args);return XMLHttpRequest[c]=!0,l}(o);return t[u]&&T(o),d}}),w=o(t,"abort",function(){return function(t,n){var r=t[a];if(r&&"string"==typeof r.type){if(r.data&&r.data.aborted)return;!function(t){t.state=S,e(S,t),t.data.aborted=!0}(r)}return w.apply(t,n)}})}function T(t){t.state=m,e(m,t)}},XHR_URL:f,XHR_METHOD:l}},function(e,t,n){"use strict";e.exports=n(29).polyfill()},function(e,t,n){"use strict";var r,i,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};o=function(){function e(e){return"function"==typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,r=void 0,i=void 0,o=function(e,t){h[n]=e,h[n+1]=t,2===(n+=2)&&(i?i(d):S())};var s="undefined"!=typeof window?window:void 0,c=s||{},u=c.MutationObserver||c.WebKitMutationObserver,f="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function v(){var e=setTimeout;return function(){return e(d,1)}}var h=new Array(1e3);function d(){for(var e=0;e<n;e+=2){(0,h[e])(h[e+1]),h[e]=void 0,h[e+1]=void 0}n=0}var p,g,y,m,S=void 0;function b(e,t){var n=this,r=new this.constructor(T);void 0===r[w]&&D(r);var i=n._state;if(i){var a=arguments[i-1];o(function(){return j(i,r,a,n._result)})}else P(n,r,e,t);return r}function _(e){if(e&&"object"===(void 0===e?"undefined":a(e))&&e.constructor===this)return e;var t=new this(T);return N(t,e),t}f?S=function(){return process.nextTick(d)}:u?(g=0,y=new u(d),m=document.createTextNode(""),y.observe(m,{characterData:!0}),S=function(){m.data=g=++g%2}):l?((p=new MessageChannel).port1.onmessage=d,S=function(){return p.port2.postMessage(0)}):S=void 0===s?function(){try{var e=Function("return this")().require("vertx");return void 0!==(r=e.runOnLoop||e.runOnContext)?function(){r(d)}:v()}catch(e){return v()}}():v();var w=Math.random().toString(36).substring(2);function T(){}var k=void 0,x=1,E=2,C={error:null};function L(e){try{return e.then}catch(e){return C.error=e,C}}function O(t,n,r){n.constructor===t.constructor&&r===b&&n.constructor.resolve===_?function(e,t){t._state===x?I(e,t._result):t._state===E?F(e,t._result):P(t,void 0,function(t){return N(e,t)},function(t){return F(e,t)})}(t,n):r===C?(F(t,C.error),C.error=null):void 0===r?I(t,n):e(r)?function(e,t,n){o(function(e){var r=!1,i=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,function(n){r||(r=!0,t!==n?N(e,n):I(e,n))},function(t){r||(r=!0,F(e,t))},e._label);!r&&i&&(r=!0,F(e,i))},e)}(t,n,r):I(t,n)}function N(e,t){var n,r;e===t?F(e,new TypeError("You cannot resolve a promise with itself")):(r=void 0===(n=t)?"undefined":a(n),null===n||"object"!==r&&"function"!==r?I(e,t):O(e,t,L(t)))}function A(e){e._onerror&&e._onerror(e._result),M(e)}function I(e,t){e._state===k&&(e._result=t,e._state=x,0!==e._subscribers.length&&o(M,e))}function F(e,t){e._state===k&&(e._state=E,e._result=t,o(A,e))}function P(e,t,n,r){var i=e._subscribers,a=i.length;e._onerror=null,i[a]=t,i[a+x]=n,i[a+E]=r,0===a&&e._state&&o(M,e)}function M(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,o=e._result,a=0;a<t.length;a+=3)r=t[a],i=t[a+n],r?j(n,r,i,o):i(o);e._subscribers.length=0}}function j(t,n,r,i){var o=e(r),a=void 0,s=void 0,c=void 0,u=void 0;if(o){if((a=function(e,t){try{return e(t)}catch(e){return C.error=e,C}}(r,i))===C?(u=!0,s=a.error,a.error=null):c=!0,n===a)return void F(n,new TypeError("A promises callback cannot return that same promise."))}else a=i,c=!0;n._state!==k||(o&&c?N(n,a):u?F(n,s):t===x?I(n,a):t===E&&F(n,a))}var R=0;function D(e){e[w]=R++,e._state=void 0,e._result=void 0,e._subscribers=[]}var U=function(){function e(e,n){this._instanceConstructor=e,this.promise=new e(T),this.promise[w]||D(this.promise),t(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&I(this.promise,this._result))):F(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===k&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===_){var i=L(e);if(i===b&&e._state!==k)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===q){var o=new n(T);O(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===k&&(this._remaining--,e===E?F(r,n):this._result[t]=n),0===this._remaining&&I(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;P(e,void 0,function(e){return n._settledAt(x,t,e)},function(e){return n._settledAt(E,t,e)})},e}();var q=function(){function e(t){this[w]=R++,this._result=this._state=void 0,this._subscribers=[],T!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){N(e,t)},function(t){F(e,t)})}catch(t){F(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){throw n})})},e}();return q.prototype.then=b,q.all=function(e){return new U(this,e).promise},q.race=function(e){var n=this;return t(e)?new n(function(t,r){for(var i=e.length,o=0;o<i;o++)n.resolve(e[o]).then(t,r)}):new n(function(e,t){return t(new TypeError("You must pass an array to race."))})},q.resolve=_,q.reject=function(e){var t=new this(T);return F(t,e),t},q._setScheduler=function(e){i=e},q._setAsap=function(e){o=e},q._asap=o,q.polyfill=function(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=q},q.Promise=q,q},"object"===a(t)&&void 0!==e?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(1).patching.subscription,o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._disable=n,this.serviceFactory=t,this._initialized=!1}return r(e,[{key:"init",value:function(e){if(this.isEnabled()&&!this._initialized){this._initialized=!0;var t=this.serviceFactory.getService("ConfigService");t.setConfig({agentName:"js-base",agentVersion:"0.10.3"}),t.setConfig(e),this.serviceFactory.init(),this.serviceFactory.getService("ErrorLogging").registerGlobalEventListener(),this.serviceFactory.getService("PerformanceMonitoring").init();var n=this;this.cancelPatchSub=i.subscribe(function(e,t){if("schedule"===e&&"XMLHttpRequest.send"===t.source&&t.data){var r=t.data.method+" "+t.data.url,i=n.startSpan(r,"ext.HttpRequest");i&&(i.setContext({http:{method:t.data.method,url:t.data.url,sync:t.data.sync}}),t.data.span=i)}else"invoke"===e&&t.data&&t.data.span&&(t.data.span.setContext({http:{status:t.data.target.status}}),t.data.span.end())}),this._sendPageLoadMetrics()}return this}},{key:"_sendPageLoadMetrics",value:function(){var e=this.serviceFactory.getService("TransactionService"),t=this.serviceFactory.getService("ConfigService"),n=function(){setTimeout(function(){t.get("sendPageLoadTransaction")&&e.sendPageLoadMetrics()})};"complete"===document.readyState?n():window.addEventListener("load",n)}},{key:"isEnabled",value:function(){return!this._disable}},{key:"config",value:function(e){this.serviceFactory.getService("ConfigService").setConfig(e)}},{key:"setUserContext",value:function(e){this.serviceFactory.getService("ConfigService").setUserContext(e)}},{key:"setCustomContext",value:function(e){this.serviceFactory.getService("ConfigService").setCustomContext(e)}},{key:"setTags",value:function(e){this.serviceFactory.getService("ConfigService").setTags(e)}},{key:"setInitialPageLoadName",value:function(e){this.isEnabled()&&(this.serviceFactory.getService("TransactionService").initialPageLoadName=e)}},{key:"startTransaction",value:function(e,t){if(this.isEnabled())return this.serviceFactory.getService("TransactionService").startTransaction(e,t)}},{key:"startSpan",value:function(e,t){if(this.isEnabled())return this.serviceFactory.getService("TransactionService").startSpan(e,t)}},{key:"getCurrentTransaction",value:function(){if(this.isEnabled())return this.serviceFactory.getService("TransactionService").getCurrentTransaction()}},{key:"getTransactionService",value:function(){if(this.isEnabled())return this.serviceFactory.getService("TransactionService")}},{key:"captureError",value:function(e){if(this.isEnabled())return this.serviceFactory.getService("ErrorLogging").logError(e)}},{key:"addFilter",value:function(e){this.serviceFactory.getService("ConfigService").addFilter(e)}}]),e}();e.exports=o}]);
//# sourceMappingURL=elastic-apm-js-base.umd.min.js.map